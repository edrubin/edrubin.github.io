<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Updating Intuition on Attenuation Bias</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ed Rubin</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="research.html">Research</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="cv.html">CV</a>
</li>
<li>
  <a href="blog.html">Blog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="bio.html">Bio</a>
    </li>
    <li>
      <a href="cv.html">CV</a>
    </li>
    <li>
      <a href="contact.html">Contact</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Technology</li>
    <li>
      <a href="links.html">Useful Links</a>
    </li>
    <li>
      <a href="tools.html">Favorite Tools</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="advice.html">Advice</a>
    </li>
    <li>
      <a href="meetings.html">Meetings</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="consulting.html">Consulting</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:edwardarubin@gmail.com">
    <span class="fa fa-envelope-o fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/edrubin">
    <span class="fa fa-github-square fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://www.instagram.com/edwardarubin">
    <span class="fa fa-instagram fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://www.twitter.com/edrubin">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Updating Intuition on Attenuation Bias</h1>

</div>


<p>Thursday, 30 March 2017</p>
<p><br></p>
<div id="loken-and-gelman" class="section level1">
<h1>Loken and Gelman</h1>
<p>In a recent <a href="http://science.sciencemag.org/content/355/6325/584.full"><em>Science</em> paper</a>, Eric Loken and Andrew Gelman discuss an interesting statistical nuance relevant to measurement error. Loken and Gelman begin by pointing out statisticians/econometricians/people with data and computers have the mindset that measurement error in one of our covariates biases our point estimates toward zero—the infamous <em>attenuation bias</em>. Pushing this attenuation-based mindset further, researchers infer that a statistically significant point estimate would be even larger <em>in the absence</em> of measurement error. Loken and Gelman that this second logical leap is not, in fact, logical. Why? While attenuation bias is a real thing, once we begin conditioning on statistically significant results, we add a second dimension that we must consider: power. In settings with low power—<em>e.g.</em>, small <span class="math inline">\(N\)</span> and subtantial variance—in order to “achieve” a statistically significant result, the point estimate must be quite large. Thus, the <em>attenuation effect</em> may be reversed by a <em>low-power</em> effect. The big idea here is that conditioning on significant results—a very real thing in the presence of p-hacking and publication bias—changes the behavior of something we all thought we understood—measurement error and attentuation bias.</p>
<p>Loken and Gelman’s takeaway?</p>
<blockquote>
<p>A key point for practitioners is that surprising results from small studies should not be defended by saying that they would have been even better with improved measurement.</p>
</blockquote>
</div>
<div id="simulation" class="section level1">
<h1>Simulation</h1>
<p>I thought it would be fun to replicate the results in a simple simulation.</p>
<div id="my-r-setup" class="section level2">
<h2>My R setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Packages</span>
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(viridis)
<span class="co"># My ggplot2 theme</span>
theme_ed &lt;-<span class="st"> </span><span class="kw">theme</span>(
  <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,
  <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>),
  <span class="co"># panel.border = element_rect(fill = NA, color = &quot;grey75&quot;),</span>
  <span class="dt">axis.ticks =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey95&quot;</span>, <span class="dt">size =</span> <span class="fl">0.3</span>),
  <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey95&quot;</span>, <span class="dt">size =</span> <span class="fl">0.3</span>),
  <span class="dt">panel.grid.minor =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey95&quot;</span>, <span class="dt">size =</span> <span class="fl">0.3</span>),
  <span class="dt">legend.key =</span> <span class="kw">element_blank</span>())
<span class="co"># Set seed</span>
<span class="kw">set.seed</span>(<span class="dv">12345</span>)</code></pre></div>
</div>
<div id="function-generating-data" class="section level2">
<h2>Function: Generating data</h2>
<p>One of Loken and Gelman’s big points is that sample size (specifically, power) matters for attenuation bias, once we start conditioning on statistically significant results. So let’s write a function that generates a sample of size <code>n</code> for a simple linear regression. The function will also take as inputs the true intercept <code>alpha</code> and the true slope coefficient <code>beta</code>. For simplicity, we will generate each variable from a standard normal distribution. Finally, the function will accept a third parameter <code>gamma</code> that dictates the degree of measurement error in our covariance.</p>
<p>Formally, the population data-generating process is</p>
<p><span class="math display">\[ y_i = \alpha + \beta x_i + \varepsilon_i \]</span></p>
<p>but instead of observing <span class="math inline">\(x_i\)</span>, the researcher observes</p>
<p><span class="math display">\[ w_i = x_i + \gamma u_i \]</span></p>
<p>where <span class="math inline">\(\gamma u_i\)</span> is the “noise” that we add to <span class="math inline">\(x_i\)</span> to generate measurement error. Again, we will assume <span class="math inline">\(u_i\)</span> comes from a standard normal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_data &lt;-<span class="st"> </span><span class="cf">function</span>(n, alpha, beta, gamma) {
  <span class="co"># Generate x, e (disturbance), and u</span>
  gen_dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(
    <span class="dt">x =</span> <span class="kw">rnorm</span>(n),
    <span class="dt">e =</span> <span class="kw">rnorm</span>(n),
    <span class="dt">u =</span> <span class="kw">rnorm</span>(n)
    )
  <span class="co"># Calculate w and y</span>
  gen_dt[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(
    <span class="dt">w =</span> x <span class="op">+</span><span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span>u,
    <span class="dt">y =</span> alpha <span class="op">+</span><span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>e
    )]
  <span class="co"># Return the data</span>
  <span class="kw">return</span>(gen_dt)
}</code></pre></div>
</div>
<div id="function-running-the-simulation" class="section level2">
<h2>Function: Running the simulation</h2>
<p>In the simulation, we will regress <span class="math inline">\(\mathbf{y}\)</span> on <span class="math inline">\(\mathbf{w}\)</span> (and a column of ones) and then calculate the standard errors, <em>t</em> statistics, and <em>p</em>-values. The <code>base</code> installation’s <code>lm()</code> function works just fine in this context. We’ll ignore inference/estimates for the intercept.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_reg &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="co"># Run the regression without measurement error</span>
  reg_clean &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># Grab the second row</span>
<span class="st">    </span><span class="kw">extract</span>(<span class="dv">2</span>, ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># Force to matrix then to data.table</span>
<span class="st">    </span><span class="kw">matrix</span>(<span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.table</span>()
  <span class="co"># Run the regression with measurement error</span>
  reg_noise &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>w, data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># Grab the second row</span>
<span class="st">    </span><span class="kw">extract</span>(<span class="dv">2</span>, ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># Force to matrix then to data.table</span>
<span class="st">    </span><span class="kw">matrix</span>(<span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.table</span>()
  reg_dt &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(<span class="kw">list</span>(reg_clean, reg_noise))
  <span class="co"># Set names</span>
  <span class="kw">setnames</span>(reg_dt, <span class="kw">c</span>(<span class="st">&quot;est_coef&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;t_stat&quot;</span>, <span class="st">&quot;p_value&quot;</span>))
  <span class="co"># Add column for type of regression</span>
  reg_dt[, type <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;clean&quot;</span>, <span class="st">&quot;noise&quot;</span>)]
  <span class="co"># Return reg_dt</span>
  <span class="kw">return</span>(reg_dt)
}</code></pre></div>
<p>Now we’ll make a wrapper function that applies <code>sim_data()</code> and <code>sim_reg()</code>, effectively running a single iteration of the simulation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_one &lt;-<span class="st"> </span><span class="cf">function</span>(n, alpha, beta, gamma) {
  <span class="co"># Run the regression function on simulated data</span>
  one_dt &lt;-<span class="st"> </span><span class="kw">sim_reg</span>(<span class="dt">data =</span> <span class="kw">sim_data</span>(n, alpha, beta, gamma))
  <span class="co"># Add the sample size</span>
  one_dt[, n <span class="op">:</span><span class="er">=</span><span class="st"> </span>n]
  <span class="co"># Return the results</span>
  <span class="kw">return</span>(one_dt)
}</code></pre></div>
<p>And now a function to run the simulation <code>n_iter</code> times for the given set of parameters (<code>n_iter</code> times for each sample size <code>n</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_run &lt;-<span class="st"> </span><span class="cf">function</span>(n_iter, n, alpha, beta, gamma, <span class="dt">n_cores =</span> <span class="dv">4</span>) {
  <span class="co"># Run n_iter</span>
  sim_dt &lt;-<span class="st"> </span><span class="kw">mclapply</span>(
    <span class="dt">X =</span> <span class="kw">rep</span>(n, <span class="dt">each =</span> n_iter),
    <span class="dt">FUN =</span> sim_one,
    <span class="dt">alpha =</span> alpha, <span class="dt">beta =</span> beta, <span class="dt">gamma =</span> gamma,
    <span class="dt">mc.cores =</span> n_cores) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rbindlist</span>()
  <span class="co"># Record the parameter values</span>
  sim_dt[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">alpha =</span> alpha, <span class="dt">beta =</span> beta, <span class="dt">gamma =</span> gamma)]
  <span class="co"># Return the simulation results</span>
  <span class="kw">return</span>(sim_dt)
}</code></pre></div>
</div>
<div id="run-the-simulation-three-sample-sizes" class="section level2">
<h2>Run the simulation, three sample sizes</h2>
<p>Now let’s actually run the simulation. Let’s start with three sample sizes: 30, 100, 1000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_sim &lt;-<span class="st"> </span><span class="kw">sim_run</span>(
  <span class="dt">n_iter =</span> <span class="fl">1e4</span>,
  <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">100</span>, <span class="fl">1e3</span>),
  <span class="dt">alpha =</span> <span class="dv">10</span>,
  <span class="dt">beta =</span> <span class="dv">1</span>,
  <span class="dt">gamma =</span> <span class="fl">0.25</span>,
  <span class="dt">n_cores =</span> <span class="dv">4</span>)</code></pre></div>
</div>
<div id="examine-results-three-sample-sizes" class="section level2">
<h2>Examine results, three sample sizes</h2>
<p>A few quick changes for plotting/description:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add a variable for a significant result (0.05 level)</span>
the_sim[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(
  <span class="dt">sig =</span> p_value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>,
  <span class="dt">n_fac =</span> <span class="kw">factor</span>(n, <span class="dt">ordered =</span> T)
  )] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()</code></pre></div>
<p>Examine the results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Compare means by sample size</span>
the_sim[type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>, <span class="kw">list</span>(
  <span class="dt">mean_coef =</span> <span class="kw">mean</span>(est_coef),
  <span class="dt">pct_sample =</span> .N<span class="op">/</span><span class="fl">1e4</span>
  ), by =<span class="st"> </span>n]</code></pre></div>
<pre><code>##       n mean_coef pct_sample
## 1:   30 0.9436209          1
## 2:  100 0.9407640          1
## 3: 1000 0.9414561          1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Compare means by sample size and significance</span>
the_sim[type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>, <span class="kw">list</span>(
  <span class="dt">mean_coef =</span> <span class="kw">mean</span>(est_coef),
  <span class="dt">pct_sample =</span> .N<span class="op">/</span><span class="fl">1e4</span>
  ), by =<span class="st"> </span>.(n, sig)]</code></pre></div>
<pre><code>##       n   sig mean_coef pct_sample
## 1:   30  TRUE 0.9472367     0.9932
## 2:   30 FALSE 0.4155048     0.0068
## 3:  100  TRUE 0.9407640     1.0000
## 4: 1000  TRUE 0.9414561     1.0000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Compare pct. of coef. &gt; 1, by sample size and significance</span>
the_sim[type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>, <span class="kw">list</span>(
  <span class="dt">pct_exceed =</span> <span class="kw">mean</span>(est_coef <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>),
  <span class="dt">pct_sample =</span> .N<span class="op">/</span><span class="fl">1e4</span>
  ), by =<span class="st"> </span>.(n, sig)]</code></pre></div>
<pre><code>##       n   sig pct_exceed pct_sample
## 1:   30  TRUE  0.3810914     0.9932
## 2:   30 FALSE  0.0000000     0.0068
## 3:  100  TRUE  0.2763000     1.0000
## 4: 1000  TRUE  0.0331000     1.0000</code></pre>
<p>Let’s plot the distribution of significant coefficient estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(the_sim[(sig <span class="op">==</span><span class="st"> </span>T) <span class="op">&amp;</span><span class="st"> </span>(type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>)], <span class="kw">aes</span>(est_coef)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> n_fac),
    <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">widehat</span>(beta), <span class="st">&quot; (estimated coefficient)&quot;</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Density&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Distribution of estimated coefficients, by sample size&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;in the presence of measurement error&quot;</span>) <span class="op">+</span>
<span class="st">  </span>theme_ed <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="st">&quot;Sample size:&quot;</span>,
    <span class="dt">discrete =</span> T, <span class="dt">direction =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">begin =</span> <span class="fl">0.05</span>, <span class="dt">end =</span> <span class="fl">0.90</span>)</code></pre></div>
<p><img src="blog20170330_files/figure-html/plot%20dist%20coef-1.png" width="768" /></p>
<p>We can also make a nice comparison of the estimated coefficient compared with the “ideal” estimate (without measurement error), following Loken and Gelman’s figure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a &#39;paired&#39; data.table</span>
the_sim[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>(.N<span class="op">/</span><span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">2</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()
clean_dt &lt;-<span class="st"> </span>the_sim[type <span class="op">==</span><span class="st"> &quot;clean&quot;</span>]
noise_dt &lt;-<span class="st"> </span>the_sim[type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>]
pair_dt &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> clean_dt, <span class="dt">y =</span> noise_dt,
  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">all =</span> T, <span class="dt">suffixes =</span> <span class="kw">c</span>(<span class="st">&quot;_clean&quot;</span>, <span class="st">&quot;_noise&quot;</span>))
<span class="co"># Clean up</span>
<span class="kw">rm</span>(clean_dt, noise_dt)
<span class="kw">gc</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()
<span class="co"># Plot</span>
<span class="kw">ggplot</span>(pair_dt[sig_noise <span class="op">==</span><span class="st"> </span>T],
  <span class="kw">aes</span>(<span class="dt">x =</span> est_coef_clean, est_coef_noise)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> n_fac_noise),
    <span class="dt">size =</span> <span class="fl">0.25</span>, <span class="dt">alpha =</span> <span class="fl">0.75</span>, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> <span class="cf">function</span>(x) x, <span class="dt">size =</span> <span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">Ideal</span><span class="ch">\&quot;</span><span class="st"> estimate (no measurement error)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate with measurement error&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Comparison of estimates with and without measurement error&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;by sample size&quot;</span>) <span class="op">+</span>
<span class="st">  </span>theme_ed <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_viridis</span>(<span class="st">&quot;Sample size:&quot;</span>,
    <span class="dt">discrete =</span> T, <span class="dt">direction =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">begin =</span> <span class="fl">0.05</span>, <span class="dt">end =</span> <span class="fl">0.90</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="kw">guide_legend</span>(
    <span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">stroke =</span> <span class="dv">1</span>)))</code></pre></div>
<p><img src="blog20170330_files/figure-html/plot%20ideal%20vs.%20estimated-1.png" width="768" /></p>
<p>We again see Loken and Gelman’s point: for smaller sizes, (conditional on a significant result) we frequently see point estimates from the “measure with error” regression that exceed the corresponding point estimates from regressions measured without error—not exactly the attenuation story we typically have in mind.</p>
</div>
<div id="run-the-simulation-many-sample-sizes" class="section level2">
<h2>Run the simulation, many sample sizes</h2>
<p>Now let’s run the simulation for a bunch of sample sizes.</p>
<p><strong>Note</strong>: You may want to drop the number of iterations per sample size to 1,000 (from 10,000) so it finishes in a reasonable amount of time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">big_sim &lt;-<span class="st"> </span><span class="kw">sim_run</span>(
  <span class="dt">n_iter =</span> <span class="fl">1e4</span>,
  <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="kw">seq</span>(<span class="dv">50</span>, <span class="fl">3e3</span>, <span class="dv">50</span>)),
  <span class="dt">alpha =</span> <span class="dv">10</span>,
  <span class="dt">beta =</span> <span class="dv">1</span>,
  <span class="dt">gamma =</span> <span class="fl">0.25</span>,
  <span class="dt">n_cores =</span> <span class="dv">4</span>)</code></pre></div>
<p>To replicate Loken and Gelman’s final figure, we need to generate a quick summary table (after pairing the results). In this table, for each sample size, we will calculate the percent of studies where</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add ID column</span>
big_sim[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>(.N<span class="op">/</span><span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">2</span>)] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()
<span class="co"># Separate the &#39;clean&#39; and &#39;noise&#39; observations</span>
big_clean &lt;-<span class="st"> </span>big_sim[type <span class="op">==</span><span class="st"> &quot;clean&quot;</span>]
big_noise &lt;-<span class="st"> </span>big_sim[type <span class="op">==</span><span class="st"> &quot;noise&quot;</span>]
<span class="co"># Merge</span>
big_paired &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> big_clean, <span class="dt">y =</span> big_noise,
  <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">all =</span> T, <span class="dt">suffixes =</span> <span class="kw">c</span>(<span class="st">&quot;_clean&quot;</span>, <span class="st">&quot;_noise&quot;</span>))
<span class="co"># The summary</span>
big_summary &lt;-<span class="st"> </span>big_paired[, <span class="kw">list</span>(
  <span class="dt">pct_exceed =</span> <span class="kw">mean</span>(est_coef_noise <span class="op">&gt;</span><span class="st"> </span>est_coef_clean)
  ), by =<span class="st"> </span>n_noise]
<span class="kw">setnames</span>(big_summary, <span class="st">&quot;n_noise&quot;</span>, <span class="st">&quot;n&quot;</span>)
<span class="co"># Clean up</span>
<span class="kw">rm</span>(big_clean, big_noise, big_paired)
<span class="kw">gc</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">invisible</span>()</code></pre></div>
<p>Now we can create the figure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(big_summary, <span class="kw">aes</span>(n, pct_exceed)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> n), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_smooth() +</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;The effect of sample size on attenuation bias&quot;</span>,
    <span class="dt">subtitle =</span> <span class="kw">paste</span>(<span class="st">&quot;Percent of studies where measurement-error&quot;</span>,
      <span class="st">&quot;based estimate exceeds ideal estimate&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Sample size&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Percent&quot;</span>) <span class="op">+</span>
<span class="st">  </span>theme_ed <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="st">&quot;legend.position&quot;</span> =<span class="st"> &quot;none&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_viridis</span>(<span class="st">&quot;Sample size:&quot;</span>, <span class="dt">direction =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">end =</span> <span class="fl">0.97</span>)</code></pre></div>
<p><img src="blog20170330_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>This figure does not quite match the figure from Loken and Gelman. Why? One important observation that I don’t think Loken and Gelman really discuss: their results vary by the parameters in the simulation: the treatment effect (<span class="math inline">\(\beta\)</span>), the degree of measurement error <span class="math inline">\(\gamma\)</span> (maps to the variance of the measurement error), and the variance of the disturbance <span class="math inline">\(\varepsilon\)</span>.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Loken and Gelman make a pretty interesting observation: attenuation bias may not have the same effect in small samples that it has in large samples.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> I think the big picture is that some of our econometric/statistical intuition changes in the presence of p-hacking or publication bias—the theory behind our estimation and inference typically does not take into account p-hacking or publication bias.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>As discussed above, this result depends upon several parameters.<a href="#fnref1">↩</a></p></li>
</ol>
</div>

<!-- <?php include_once("analyticstracking.php") ?> -->

<!-- For Google Analytics: -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-88887510-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Start of LiveChat (www.livechatinc.com) code -->
<!-- <script type="text/javascript">
window.__lc = window.__lc || {};
window.__lc.license = 8929129;
(function() {
  var lc = document.createElement('script'); lc.type = 'text/javascript'; lc.async = true;
  lc.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'cdn.livechatinc.com/tracking.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(lc, s);
})();
</script> -->
<!-- End of LiveChat code -->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
